# Vue.js Camera App - Модульная архитектура

## Обзор архитектуры

Приложение Vue.js Camera App построено на модульной архитектуре, следуя принципам разделения ответственности и повторного использования кода. Приложение поддерживает создание фотографий и запись видео с последующим управлением коллекцией медиа-файлов и их загрузкой в ST Drive API.

## Уровни абстракции

### 1. Модель данных
- `Photo.js` - класс, представляющий модель фотографии с методами для работы с данными.
- `Video.js` - класс, представляющий модель видеозаписи с методами для работы с данными.

### 2. Сервисный слой
- `mockServer.js` - имитация серверного API для хранения фотографий и видео с поддержкой ST Drive.
- `mediaService.js` - сервис для взаимодействия с API (через mockServer).

### 3. Утилиты
- `mediaUtils.js` - вспомогательные функции для работы с медиа-файлами (изображениями и видео).

### 4. Композиционные функции (Composables)
- `useCamera.js` - логика работы с камерой устройства.
- `usePhotoGallery.js` - логика работы с галереей фотографий.
- `useVideoRecorder.js` - логика записи видео с камеры.
- `useVideoGallery.js` - логика работы с галереей видео.

### 5. UI компоненты
- `CameraApp.vue` - главный компонент приложения.
- `CameraView.vue` - компонент для отображения камеры и управления ей.
- `PhotoGallery.vue` - компонент для отображения галереи фотографий.
- `PhotoItem.vue` - компонент для отображения отдельной фотографии в галерее.
- `PhotoModal.vue` - модальное окно для просмотра фотографии в полном размере.
- `VideoGallery.vue` - компонент для отображения галереи видеозаписей.
- `VideoItem.vue` - компонент для отображения отдельной видеозаписи в галерее.
- `VideoModal.vue` - модальное окно для просмотра видео в полном размере.

## Описание компонентов

### Модель данных

#### Photo.js
Класс для представления фотографий с методами для:
- Генерации ID
- Создания объекта из серверных данных
- Преобразования в формат для отправки на сервер

#### Video.js
Класс для представления видеозаписей с методами для:
- Генерации ID
- Создания объекта из серверных данных
- Хранения информации о формате, длительности и превью видео

### Сервисный слой

#### mockServer.js
Имитирует серверное API с методами:
- `getPhotos()` / `getVideos()` - получение списка фотографий/видео
- `addPhoto(photo)` / `addVideo(video)` - добавление новой фотографии/видео
- `deletePhoto(id)` / `deleteVideo(id)` - удаление фотографии/видео по ID
- Интеграция с ST Drive API для облачного хранения медиа-файлов

#### mediaService.js
Посредник между UI и сервером, инкапсулирует логику работы с API:
- `getPhotos()` / `getVideos()` - загрузка фотографий/видео с сервера
- `uploadPhoto(photo)` / `uploadVideo(video)` - загрузка фото/видео на сервер
- `deletePhoto(id)` / `deleteVideo(id)` - удаление фото/видео с сервера

### Утилиты

#### mediaUtils.js
Функции для работы с медиа-файлами:
- `dataURLtoBlob()` - преобразование Data URL в Blob
- `captureVideoFrame()` - создание скриншота с видеоэлемента
- `createVideoThumbnail()` - создание миниатюры для видео
- `getVideoDuration()` - получение длительности видео
- `downloadImage()` / `downloadVideo()` - скачивание медиа-файлов

### Композиционные функции

#### useCamera.js
Хук для работы с камерой устройства:
- Включение/выключение камеры
- Переключение между фронтальной и основной камерой
- Создание снимков

#### usePhotoGallery.js
Хук для работы с галереей фотографий:
- Загрузка фотографий с сервера
- Добавление/удаление фотографий
- Загрузка фотографий на сервер
- Управление выбранной фотографией

#### useVideoRecorder.js
Хук для работы с записью видео:
- Инициализация медиа-потока
- Запись видео с камеры
- Создание превью видео
- Получение длительности видео

#### useVideoGallery.js
Хук для работы с галереей видеозаписей:
- Загрузка видео с сервера
- Добавление/удаление видеозаписей
- Загрузка видео на сервер
- Управление выбранным видео

### UI компоненты

#### CameraApp.vue
Главный компонент, объединяющий все части приложения.

#### CameraView.vue
Компонент для отображения камеры и управления ей:
- Переключение режимов фото/видео
- Захват фото
- Запись видео
- Контроль доступа к камере

#### PhotoGallery.vue и VideoGallery.vue
Компоненты для отображения галерей фотографий и видеозаписей.

#### PhotoItem.vue и VideoItem.vue
Компоненты для отображения отдельных медиа-файлов в галерее с кнопками для действий.

#### PhotoModal.vue и VideoModal.vue
Модальные окна для просмотра медиа-файлов в полном размере.

## Преимущества модульной архитектуры

1. **Разделение ответственности** - каждый компонент отвечает только за свою часть функциональности.
2. **Повторное использование** - общая логика вынесена в отдельные функции и классы.
3. **Тестируемость** - изолированные компоненты можно легко тестировать.
4. **Масштабируемость** - новые функции можно добавлять, не изменяя существующий код.
5. **Удобство поддержки** - упрощается поиск ошибок и внесение изменений.

## Поток данных

1. Пользователь взаимодействует с UI компонентами.
2. Компоненты используют композиционные функции для работы с логикой.
3. Композиционные функции обращаются к сервисному слою.
4. Сервисный слой взаимодействует с API (mockServer).
5. Данные возвращаются по тому же пути обратно к UI.

## Интеграция с ST Drive API

Для хранения медиа-файлов в облаке реализована интеграция с ST Drive API:

1. При загрузке фото или видео в приложение файлы отправляются в ST Drive
2. Для работы с API используются JWT токены для авторизации
3. Настройка API осуществляется через переменные окружения
4. Поддерживаются различные форматы медиа-файлов

## Дальнейшие улучшения

- Добавление управления состоянием через Pinia/Vuex
- Внедрение TypeScript для типизации
- Написание модульных тестов
- Добавление маршрутизации для многостраничного приложения
- Реализация реального серверного API
